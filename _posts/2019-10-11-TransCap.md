---
layout: post
title: 'Transfer Capsule Network Aspect-leval Sentiment Classification'
date: 2019-10-11
author: 被水淹死的鱼
color: pink
cover: 'http://img4.imgtn.bdimg.com/it/u=3097276623,872202985&fm=26&gp=0.jpg'
tags: Aspect-level 情感分析 NLP
---

# Transfer Capsule Network Aspect-leval Sentiment Classification 论文总结

目录：
* 目录
{:toc}

> 这是一篇使用胶囊网络作 aspect-level 的情感分类的文章。由于 aspect-level 语料标注成本太高，但是 document-level 的标注会随着评论的打分自动生成。所以作者想将 document-level 的中包含的情感知识迁移到 aspect-level 的情感分类中。作者提出的模型叫 Transfer Capsule Network(TranCap) 。模型通过 Aspect-Routing 方法将句子级别的语义表示送入胶囊中生成 Sentiment-Capsule。这个过程中，document-level 和 aspect-level 学习任务所用的数据是共享的。然后模型使用扩展的动态路由方法在迁移学习框架下，将 Class-Capsule 与 Sentiment-Capsule 相结合。
> 

## 论文正文

> 在给出框架之前，作者提到了之前工作中唯一将考虑到 document-level 数据对 aspect-level 情感分类有帮助的文章：[Exploiting document knowledge for aspect-level sentiment classification](http://papers.nips.cc/paper/6139-supervised-word-movers-distance)。但是文章中仅仅将文档级别的知识用于提升在情感分类中的单词表示。


> 模型分为四个部分（Input Layer，Feature Capsule Layer，Sentiment Capsule Layer，Class Capsule Layer）。在介绍这四部分之前，我们先看下准备工作。



### Definitions and Preliminary


###Input Layer 



###Feature Capsule Layer



###Sentiment Capsule Layer



###Class Capsule Layer


## 实验


代码：


环境：
|  框架  | 版本  |
|  ----  | ----  |
| python  | 3.6 |
| tensorflow  | 1.3.0 |
| spacy  | 1.9.0 |
| numpy  | 1.16.4 |
| scikit-learn  | 0.21.2 |


代码运行结果：
```
-----------------------------------Parameters-----------------------------------
ASC:restaurant  DSC:yelp  batch_size:128  learning_rate:0.001  n_iter:25  gamma:0.1  
embedding_dim:300  position_dim:100  max_sentence_len:85  max_target_len:25  keep_prob1:0.5  keep_prob2:1.0  
filter_size:3  sc_num:16  sc_dim:16  cc_num:3  cc_dim:24  iter_routing:3  reuse_embedding:True  
Reuse Word Dictionary & Embedding
I am TransCap.
/Users/tenglei/anaconda3/envs/python36/lib/python3.6/site-packages/sklearn/metrics/classification.py:1437: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.
  'precision', 'predicted', average, warn_for)
-------------------------------------Iter0--------------------------------------
train loss=21.095925, dev loss=4.809143, dev acc=0.5264, step=276
test acc=0.6027, test precision=0.3819, test recall=0.4843, test f1=0.3992
max step:0, early stop step:0
-------------------------------------Iter1--------------------------------------
train loss=20.611658, dev loss=4.775376, dev acc=0.5347, step=552
test acc=0.6250, test precision=0.3812, test recall=0.4808, test f1=0.4054
max step:0, early stop step:0
-------------------------------------Iter2--------------------------------------
train loss=19.697614, dev loss=3.958563, dev acc=0.7097, step=828
test acc=0.7625, test precision=0.6562, test recall=0.6284, test f1=0.6386
max step:0, early stop step:0
-------------------------------------Iter3--------------------------------------
train loss=17.409067, dev loss=3.989774, dev acc=0.7028, step=1104
test acc=0.7661, test precision=0.6672, test recall=0.6737, test f1=0.6690
max step:1, early stop step:1
-------------------------------------Iter4--------------------------------------
train loss=16.644083, dev loss=3.977106, dev acc=0.7181, step=1380
test acc=0.7777, test precision=0.6832, test recall=0.6735, test f1=0.6759
max step:1, early stop step:0
-------------------------------------Iter5--------------------------------------
train loss=16.252635, dev loss=3.884354, dev acc=0.7083, step=1656
test acc=0.7812, test precision=0.6876, test recall=0.6902, test f1=0.6860
max step:1, early stop step:0
-------------------------------------Iter6--------------------------------------
train loss=15.905244, dev loss=3.940876, dev acc=0.6972, step=1932
test acc=0.7786, test precision=0.6868, test recall=0.6975, test f1=0.6919
max step:1, early stop step:1
-------------------------------------Iter7--------------------------------------
train loss=15.619341, dev loss=3.967409, dev acc=0.7028, step=2208
test acc=0.7812, test precision=0.6890, test recall=0.7076, test f1=0.6964
max step:2, early stop step:2
-------------------------------------Iter8--------------------------------------
train loss=15.399837, dev loss=3.986988, dev acc=0.7292, step=2484
test acc=0.7866, test precision=0.6967, test recall=0.6880, test f1=0.6914
max step:2, early stop step:0
-------------------------------------Iter9--------------------------------------
train loss=15.273066, dev loss=3.966811, dev acc=0.7194, step=2760
test acc=0.7786, test precision=0.6840, test recall=0.6888, test f1=0.6851
max step:2, early stop step:1
-------------------------------------Iter10-------------------------------------
train loss=15.146978, dev loss=3.986271, dev acc=0.7222, step=3036
test acc=0.7830, test precision=0.6898, test recall=0.6949, test f1=0.6913
max step:2, early stop step:2
-------------------------------------Iter11-------------------------------------
train loss=15.010345, dev loss=3.945945, dev acc=0.7236, step=3312
test acc=0.7866, test precision=0.6958, test recall=0.7004, test f1=0.6962
max step:3, early stop step:3
-------------------------------------Iter12-------------------------------------
train loss=14.911338, dev loss=3.986659, dev acc=0.7333, step=3588
test acc=0.7893, test precision=0.7010, test recall=0.6968, test f1=0.6974
max step:3, early stop step:0
-------------------------------------Iter13-------------------------------------
train loss=14.855781, dev loss=3.968890, dev acc=0.7292, step=3864
test acc=0.7848, test precision=0.6930, test recall=0.6983, test f1=0.6943
max step:3, early stop step:1
-------------------------------------Iter14-------------------------------------
train loss=14.757259, dev loss=4.001243, dev acc=0.7181, step=4140
test acc=0.7866, test precision=0.6955, test recall=0.7054, test f1=0.6994
max step:3, early stop step:2
-------------------------------------Iter15-------------------------------------
train loss=14.683246, dev loss=3.991354, dev acc=0.7347, step=4416
test acc=0.7911, test precision=0.7042, test recall=0.7027, test f1=0.6995
max step:3, early stop step:0
-------------------------------------Iter16-------------------------------------
train loss=14.614182, dev loss=4.021843, dev acc=0.7236, step=4692
test acc=0.7902, test precision=0.7009, test recall=0.7085, test f1=0.7027
max step:3, early stop step:1
-------------------------------------Iter17-------------------------------------
train loss=14.561067, dev loss=4.015202, dev acc=0.7139, step=4968
test acc=0.7875, test precision=0.6999, test recall=0.7183, test f1=0.7070
max step:3, early stop step:2
-------------------------------------Iter18-------------------------------------
train loss=14.504781, dev loss=4.058889, dev acc=0.7222, step=5244
test acc=0.7830, test precision=0.6946, test recall=0.7085, test f1=0.7008
max step:3, early stop step:3
-------------------------------------Iter19-------------------------------------
train loss=14.429248, dev loss=3.994798, dev acc=0.7361, step=5520
test acc=0.7893, test precision=0.7011, test recall=0.7068, test f1=0.6996
max step:3, early stop step:0
-------------------------------------Iter20-------------------------------------
train loss=14.429852, dev loss=4.048141, dev acc=0.7292, step=5796
test acc=0.7848, test precision=0.6975, test recall=0.7107, test f1=0.7029
max step:3, early stop step:1
-------------------------------------Iter21-------------------------------------
train loss=14.393612, dev loss=4.065200, dev acc=0.7389, step=6072
test acc=0.7848, test precision=0.6971, test recall=0.7107, test f1=0.7024
max step:3, early stop step:0
-------------------------------------Iter22-------------------------------------
train loss=14.395659, dev loss=4.079736, dev acc=0.7333, step=6348
test acc=0.7848, test precision=0.6973, test recall=0.7094, test f1=0.7020
max step:3, early stop step:1
-------------------------------------Iter23-------------------------------------
train loss=14.352408, dev loss=4.047656, dev acc=0.7403, step=6624
test acc=0.7848, test precision=0.6968, test recall=0.7007, test f1=0.6976
max step:3, early stop step:0
-------------------------------------Iter24-------------------------------------
train loss=14.349510, dev loss=4.027468, dev acc=0.7389, step=6900
test acc=0.7875, test precision=0.7000, test recall=0.7083, test f1=0.7013
max step:3, early stop step:1
--------------------------------Mission Complete--------------------------------
max acc_index: 23
test_acc: 0.7848,test_f1:0.6976
min loss_index: 5
test_acc: 0.7812,test_f1:0.6860
Running Time: 231m 42s
```


## 参考文献
《Transfer Capsule Network Aspect-leval Sentiment Classification》